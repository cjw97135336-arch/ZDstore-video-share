<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>抖音热点数据管理系统</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- 统一的 Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3D5A80',
            secondary: '#6B7280',
            light: '#F3F4F6',
            dark: '#1F2937',
            douyin: '#FE2C55'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .transition-all {
        transition-property: all;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 300ms;
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- 导航栏 -->
  <nav class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4">
      <!-- 移动端导航 -->
      <div class="md:hidden flex justify-between items-center py-3">
        <h1 class="text-xl font-bold text-primary">枕朵新媒体</h1>
        <button id="menu-toggle" class="text-gray-600 hover:text-primary focus:outline-none">
          <i class="fa fa-bars text-xl"></i>
        </button>
      </div>
      
      <!-- 移动端菜单 -->
      <div id="mobile-menu" class="md:hidden hidden pb-3">
        <div class="grid grid-cols-3 gap-2">
          <a href="index.html" class="flex flex-col items-center justify-center py-3 text-gray-600 hover:bg-gray-50 rounded-md transition-all">
            <i class="fa fa-home text-xl mb-1"></i>
            <span class="text-sm">首页</span>
          </a>
          <a href="hotspot.html" class="flex flex-col items-center justify-center py-3 text-gray-600 hover:bg-gray-50 rounded-md transition-all">
            <i class="fa fa-fire text-xl mb-1"></i>
            <span class="text-sm">视频热点榜</span>
          </a>
          <a href="admin.html" class="flex flex-col items-center justify-center py-3 bg-primary text-white rounded-md hover:bg-opacity-90 transition-all">
            <i class="fa fa-cog text-xl mb-1"></i>
            <span class="text-sm">管理中心</span>
          </a>
        </div>
      </div>
      
      <!-- 桌面端导航 -->
      <div class="hidden md:flex justify-between items-center py-4">
        <div class="flex items-center space-x-2">
          <img src="https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/4942a047070f43c9989577d24fe95692.png~tplv-a9rns2rl98-24:720:720.png?rcl=20251021173658BDC366F1C82CEE98475E&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1761644218&x-signature=4MpM3mLqTz%2BjExJY%2BT526L%2B%2FPvM%3D" alt="Logo" class="h-10 w-10">
          <span class="text-xl font-bold text-primary">枕朵新媒体运营中心</span>
        </div>
        
        <div class="flex items-center space-x-8">
          <a href="index.html" class="text-gray-600 hover:text-primary transition-all">
            <i class="fa fa-home mr-1"></i> 首页
          </a>
          <a href="hotspot.html" class="text-gray-600 hover:text-primary transition-all">
            <i class="fa fa-fire mr-1"></i> 视频热点榜
          </a>
          <a href="admin.html" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-all">
            <i class="fa fa-cog mr-1"></i> 管理中心
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- 主内容区 -->
  <div class="container mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-primary mb-2">抖音热点数据管理系统</h1>
      
    </div>

    <!-- 功能按钮区 -->
    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
      <div class="flex space-x-3">
        <button id="addNewBtn" class="bg-douyin text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-all flex items-center">
          <i class="fa fa-plus mr-2"></i> 添加新热点
        </button>
        <button id="exportBtn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-all flex items-center">
          <i class="fa fa-download mr-2"></i> 导出数据
        </button>
        <label for="importFile" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-all flex items-center cursor-pointer">
          <i class="fa fa-upload mr-2"></i> 导入数据
          <input type="file" id="importFile" accept=".json" class="hidden">
        </label>
      </div>
      <div class="relative">
        <input type="text" id="searchInput" placeholder="搜索热点..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
        <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
      </div>
    </div>

    <!-- 数据统计卡片 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="bg-blue-100 p-3 rounded-full">
            <i class="fa fa-list text-blue-600 text-xl"></i>
          </div>
          <div class="ml-4">
            <h3 class="text-gray-500 text-sm">总热点数量</h3>
            <p id="totalCount" class="text-2xl font-bold">0</p>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
          <div class="bg-red-100 p-3 rounded-full">
            <i class="fa fa-fire text-douyin text-xl"></i>
          </div>
          <div class="ml-4">
            <h3 class="text-gray-500 text-sm">热门热点</h3>
            <p id="hotCount" class="text-2xl font-bold">0</p>
          </div>
        </div>
      </div>
      
    </div>

    <!-- 数据列表 -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">封面</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">标题</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分类</th>
              
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">发布时间</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">热门</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
            </tr>
          </thead>
          <tbody id="hotspotTableBody" class="bg-white divide-y divide-gray-200">
            <!-- 数据将通过JavaScript动态填充 -->
            <tr>
              <td colspan="7" class="px-6 py-4 text-center text-gray-500">
                <div class="flex justify-center items-center">
                  <i class="fa fa-spinner fa-spin mr-2"></i> 加载中...
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div id="emptyState" class="hidden px-6 py-12 text-center">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4">
          <i class="fa fa-folder-open text-gray-400 text-2xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 mb-1">没有数据</h3>
        <p class="text-gray-500 mb-6">点击"添加新热点"按钮开始创建内容</p>
        <button id="addFirstBtn" class="bg-douyin text-white px-4 py-2 rounded-md hover:bg-opacity-90 transition-all">
          <i class="fa fa-plus mr-2"></i> 添加第一个热点
        </button>
      </div>
    </div>
  </div>

  <!-- 添加/编辑热点模态框 -->
  <div id="hotspotModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 id="modalTitle" class="text-2xl font-bold text-gray-900">添加新热点</h2>
          <button id="closeModal" class="text-gray-400 hover:text-gray-500">
            <i class="fa fa-times text-xl"></i>
          </button>
        </div>
        <form id="hotspotForm">
          <input type="hidden" id="hotspotId">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="md:col-span-2">
              <label for="title" class="block text-sm font-medium text-gray-700 mb-1">标题 <span class="text-red-500">*</span></label>
              <input type="text" id="title" name="title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
            <div class="md:col-span-2">
              <label for="description" class="block text-sm font-medium text-gray-700 mb-1">描述</label>
              <textarea id="description" name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
            </div>
            <div class="md:col-span-2">
              <label for="videoCopy" class="block text-sm font-medium text-gray-700 mb-1">视频文案 <span class="text-gray-500">(用于前台页面提取内容)</span></label>
              <textarea id="videoCopy" name="videoCopy" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="输入视频文案内容，该内容不会在前台页面直接展示，仅用于提取信息"></textarea>
              <p class="mt-1 text-xs text-gray-500">提示：视频文案用于前台页面点击"提取内容"功能获取信息，不会直接显示在热点列表中</p>
            </div>
            
            <div>
              <label for="likeCount" class="block text-sm font-medium text-gray-700 mb-1">点赞数</label>
              <input type="number" id="likeCount" name="likeCount" min="0" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
            <div>
              <label for="commentCount" class="block text-sm font-medium text-gray-700 mb-1">评论数</label>
              <input type="number" id="commentCount" name="commentCount" min="0" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
            <div>
              <label for="favoriteCount" class="block text-sm font-medium text-gray-700 mb-1">收藏数</label>
              <input type="number" id="favoriteCount" name="favoriteCount" min="0" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
            <div>
              <label for="shareCount" class="block text-sm font-medium text-gray-700 mb-1">分享数</label>
              <input type="number" id="shareCount" name="shareCount" min="0" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
            <div>
              <label for="publishTime" class="block text-sm font-medium text-gray-700 mb-1">发布时间 <span class="text-red-500">*</span></label>
              <input type="date" id="publishTime" name="publishTime" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
            <div>
              <label for="videoUrl" class="block text-sm font-medium text-gray-700 mb-1">视频链接 <span class="text-red-500">*</span></label>
              <input type="url" id="videoUrl" name="videoUrl" required placeholder="https://v.douyin.com/xxx/" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
            </div>
            <div>
              <label for="coverImage" class="block text-sm font-medium text-gray-700 mb-1">封面图片</label>
              <input type="file" id="coverImage" name="coverImage" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
              <div class="mt-2">
                <img id="coverPreview" src="" alt="封面预览" class="hidden max-h-40 border rounded-md">
              </div>
              <p id="coverImageNote" class="mt-1 text-xs text-gray-500">提示：不选择新图片将保持原有图片</p>
            </div>
            <div>
              <label for="category" class="block text-sm font-medium text-gray-700 mb-1">分类 <span class="text-red-500">*</span></label>
              <select id="category" name="category" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                <option value="">请选择分类</option>
                <option value="家纺类">家纺类</option>
                <option value="家居类">家居类</option>
                <option value="IP类">IP类</option>
                <option value="其他">其他</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">常用标签</label>
              <div class="flex flex-wrap gap-2 mb-2">
                <button type="button" class="tag-preset px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-gray-100">家纺</button>
                <button type="button" class="tag-preset px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-gray-100">家居</button>
                <button type="button" class="tag-preset px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-gray-100">窗帘</button>
                <button type="button" class="tag-preset px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-gray-100">沙发</button>
                <button type="button" class="tag-preset px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-gray-100">床品</button>
                <button type="button" class="tag-preset px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-gray-100">装饰</button>
                <button type="button" class="tag-preset px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-gray-100">设计</button>
                <button type="button" class="tag-preset px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-gray-100">创意</button>
              </div>
              <label for="tags" class="block text-sm font-medium text-gray-700 mb-1">自定义标签 (用逗号分隔)</label>
              <input type="text" id="tags" name="tags" placeholder="输入标签，用逗号分隔" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
              <div id="selectedTags" class="flex flex-wrap gap-2 mt-2">
                <!-- 已选标签将在这里显示 -->
              </div>
            </div>
            <div class="md:col-span-2 flex items-center">
              <input type="checkbox" id="isHot" name="isHot" class="h-4 w-4 text-douyin focus:ring-douyin border-gray-300 rounded">
              <label for="isHot" class="ml-2 block text-sm text-gray-900">标记为热门</label>
            </div>
          </div>
          <div class="mt-8 flex justify-end space-x-3">
            <button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
              取消
            </button>
            <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-douyin hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-douyin">
              保存
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 确认删除模态框 -->
  <div id="confirmDeleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
      <div class="text-center mb-6">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4">
          <i class="fa fa-exclamation-triangle text-red-600 text-2xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 mb-1">确认删除</h3>
        <p class="text-gray-500">您确定要删除这条热点数据吗？此操作无法撤销。</p>
      </div>
      <div class="flex justify-center space-x-3">
        <button id="cancelDeleteBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
          取消
        </button>
        <button id="confirmDeleteBtn" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
          删除
        </button>
      </div>
    </div>
  </div>

  <!-- 通知提示 -->
  <div id="notification" class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-sm transform translate-y-full opacity-0 transition-all duration-300 z-50">
    <div class="flex items-start">
      <div id="notificationIcon" class="flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full mr-3">
        <i id="notificationIconI" class="fa"></i>
      </div>
      <div class="ml-3 w-0 flex-1">
        <p id="notificationTitle" class="text-sm font-medium text-gray-900"></p>
        <p id="notificationMessage" class="mt-1 text-sm text-gray-500"></p>
      </div>
      <div class="ml-4 flex-shrink-0 flex">
        <button id="closeNotification" class="inline-flex text-gray-400 hover:text-gray-500 transition-all">
          <i class="fa fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- 引入数据管理脚本 -->
  <script src="js/hotspot-manager.js"></script>
  <script>
    // 移动端菜单切换
    document.getElementById('menu-toggle').addEventListener('click', function() {
      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.toggle('hidden');
    });
    
    document.addEventListener('DOMContentLoaded', () => {
      // 标签选择功能
      const tagsInput = document.getElementById('tags');
      const selectedTagsContainer = document.getElementById('selectedTags');
      const tagPresets = document.querySelectorAll('.tag-preset');
      let selectedTags = [];
      
      // 初始化标签
      function initTags() {
        selectedTags = [];
        selectedTagsContainer.innerHTML = '';
        tagsInput.value = '';
      }
      
      // 添加标签
      function addTag(tag) {
        tag = tag.trim();
        if (tag && !selectedTags.includes(tag)) {
          selectedTags.push(tag);
          renderSelectedTags();
          updateTagsInput();
        }
      }
      
      // 移除标签
      function removeTag(tag) {
        const index = selectedTags.indexOf(tag);
        if (index !== -1) {
          selectedTags.splice(index, 1);
          renderSelectedTags();
          updateTagsInput();
        }
      }
      
      // 渲染已选标签
      function renderSelectedTags() {
        selectedTagsContainer.innerHTML = '';
        selectedTags.forEach(tag => {
          const tagElement = document.createElement('span');
          tagElement.className = 'px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-full flex items-center';
          tagElement.innerHTML = `
            ${tag}
            <button type="button" class="ml-2 text-blue-600 hover:text-blue-800">
              <i class="fa fa-times-circle"></i>
            </button>
          `;
          tagElement.querySelector('button').addEventListener('click', () => {
            removeTag(tag);
          });
          selectedTagsContainer.appendChild(tagElement);
        });
      }
      
      // 更新标签输入框
      function updateTagsInput() {
        tagsInput.value = selectedTags.join(', ');
      }
      
      // 预设标签点击事件
      tagPresets.forEach(preset => {
        preset.addEventListener('click', () => {
          addTag(preset.textContent);
        });
      });
      
      // 输入框回车事件
      tagsInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ',') {
          e.preventDefault();
          const inputValue = tagsInput.value.trim();
          if (inputValue) {
            const tags = inputValue.split(',').map(tag => tag.trim());
            tags.forEach(tag => addTag(tag));
          }
          tagsInput.value = '';
        }
      });
      
      // 封面图片预览
      const coverImageInput = document.getElementById('coverImage');
      const coverPreview = document.getElementById('coverPreview');
      
      coverImageInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            coverPreview.src = event.target.result;
            coverPreview.classList.remove('hidden');
          };
          reader.readAsDataURL(file);
        } else {
          coverPreview.src = '';
          coverPreview.classList.add('hidden');
        }
      });
      // 初始化数据
      HotspotManager.init();
      
      // 获取DOM元素
      const hotspotTableBody = document.getElementById('hotspotTableBody');
      const emptyState = document.getElementById('emptyState');
      const addNewBtn = document.getElementById('addNewBtn');
      const addFirstBtn = document.getElementById('addFirstBtn');
      const exportBtn = document.getElementById('exportBtn');
      const importFile = document.getElementById('importFile');
      const searchInput = document.getElementById('searchInput');
      const hotspotModal = document.getElementById('hotspotModal');
      const closeModal = document.getElementById('closeModal');
      const cancelBtn = document.getElementById('cancelBtn');
      const hotspotForm = document.getElementById('hotspotForm');
      const modalTitle = document.getElementById('modalTitle');
      const confirmDeleteModal = document.getElementById('confirmDeleteModal');
      const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
      const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
      const notification = document.getElementById('notification');
      const closeNotification = document.getElementById('closeNotification');
      const notificationTitle = document.getElementById('notificationTitle');
      const notificationMessage = document.getElementById('notificationMessage');
      const notificationIcon = document.getElementById('notificationIcon');
      const notificationIconI = document.getElementById('notificationIconI');
      
      // 统计数据元素
      const totalCount = document.getElementById('totalCount');
      const hotCount = document.getElementById('hotCount');
      
      
      // 当前编辑的ID
      let currentEditId = null;
      let currentDeleteId = null;
      
      // 渲染数据列表
      function renderHotspotList() {
        const searchTerm = searchInput.value.trim();
        let data = HotspotManager.getAllHotspots();
        
        // 应用搜索筛选
        if (searchTerm) {
          data = HotspotManager.filterHotspots({ search: searchTerm });
        }
        
        // 更新统计数据
        updateStatistics(data);
        
        // 清空表格
        hotspotTableBody.innerHTML = '';
        
        // 显示空状态或数据列表
        if (data.length === 0) {
          hotspotTableBody.classList.add('hidden');
          emptyState.classList.remove('hidden');
          return;
        }
        
        hotspotTableBody.classList.remove('hidden');
        emptyState.classList.add('hidden');
        
        // 渲染数据行
        data.forEach(hotspot => {
          const row = document.createElement('tr');
          row.className = 'hover:bg-gray-50';
          
          // 格式化日期
          const publishDate = new Date(hotspot.publishTime).toLocaleDateString('zh-CN');
          
          // 格式化播放量
          const formattedPlayCount = formatNumber(hotspot.playCount);
          
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10">
                  <img class="h-10 w-10 rounded-md object-cover" src="${hotspot.coverImage || 'https://via.placeholder.com/100'}" alt="${hotspot.title}">
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">${hotspot.title}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                ${hotspot.category}
              </span>
            </td>
            
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              ${publishDate}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${hotspot.isHot ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'}">
                ${hotspot.isHot ? '是' : '否'}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <button class="text-indigo-600 hover:text-indigo-900 mr-3 edit-btn" data-id="${hotspot.id}">
                编辑
              </button>
              <button class="text-red-600 hover:text-red-900 delete-btn" data-id="${hotspot.id}">
                删除
              </button>
            </td>
          `;
          
          hotspotTableBody.appendChild(row);
        });
        
        // 添加编辑和删除按钮事件
        document.querySelectorAll('.edit-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const id = btn.getAttribute('data-id');
            editHotspot(id);
          });
        });
        
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const id = btn.getAttribute('data-id');
            confirmDelete(id);
          });
        });
      }
      
      // 更新统计数据
      function updateStatistics(data) {
        totalCount.textContent = data.length;
        
        const hotItems = data.filter(item => item.isHot);
        hotCount.textContent = hotItems.length;
      }
      
      // 格式化数字
      function formatNumber(num) {
        if (num >= 10000) {
          return (num / 10000).toFixed(1) + '万';
        }
        return num.toString();
      }
      
      // 显示通知
      function showNotification(title, message, type = 'success') {
        notificationTitle.textContent = title;
        notificationMessage.textContent = message;
        
        // 设置图标和颜色
        if (type === 'success') {
          notificationIcon.className = 'flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-green-100 text-green-600 mr-3';
          notificationIconI.className = 'fa fa-check';
        } else if (type === 'error') {
          notificationIcon.className = 'flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-red-100 text-red-600 mr-3';
          notificationIconI.className = 'fa fa-times';
        } else if (type === 'warning') {
          notificationIcon.className = 'flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-yellow-100 text-yellow-600 mr-3';
          notificationIconI.className = 'fa fa-exclamation';
        } else if (type === 'info') {
          notificationIcon.className = 'flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-100 text-blue-600 mr-3';
          notificationIconI.className = 'fa fa-info';
        }
        
        // 显示通知
        notification.classList.remove('translate-y-full', 'opacity-0');
        notification.classList.add('translate-y-0', 'opacity-100');
        
        // 3秒后自动隐藏
        setTimeout(() => {
          hideNotification();
        }, 3000);
      }
      
      // 隐藏通知
      function hideNotification() {
        notification.classList.remove('translate-y-0', 'opacity-100');
        notification.classList.add('translate-y-full', 'opacity-0');
      }
      
      // 打开添加热点模态框
      function openAddModal() {
        modalTitle.textContent = '添加新热点';
        hotspotForm.reset();
        document.getElementById('hotspotId').value = '';
        currentEditId = null;
        
        // 重置标签
        initTags();
        
        // 重置封面预览
        coverPreview.src = '';
        coverPreview.classList.add('hidden');
        
        // 设置默认日期为今天
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('publishTime').value = today;
        
        hotspotModal.classList.remove('hidden');
      }
      
      // 打开编辑热点点模态框
      function editHotspot(id) {
        const hotspot = HotspotManager.getHotspotById(id);
        if (!hotspot) {
          showNotification('错误', '未找到热点数据', 'error');
          return;
        }
        
        currentEditId = id;
        modalTitle.textContent = '编辑热点';
        
        // 填充表单数据
        document.getElementById('hotspotId').value = hotspot.id;
        document.getElementById('title').value = hotspot.title;
        document.getElementById('description').value = hotspot.description || '';
        document.getElementById('videoCopy').value = hotspot.videoCopy || '';
        document.getElementById('likeCount').value = hotspot.likeCount || 0;
        document.getElementById('commentCount').value = hotspot.commentCount || 0;
        document.getElementById('favoriteCount').value = hotspot.favoriteCount || 0;
        document.getElementById('shareCount').value = hotspot.shareCount || 0;
        document.getElementById('publishTime').value = hotspot.publishTime;
        document.getElementById('videoUrl').value = hotspot.videoUrl;
        
        // 设置分类选择
        const categorySelect = document.getElementById('category');
        // 确保分类选项存在
        for (let i = 0; i < categorySelect.options.length; i++) {
          if (categorySelect.options[i].value === hotspot.category) {
            categorySelect.selectedIndex = i;
            break;
          }
        }
        
        document.getElementById('isHot').checked = hotspot.isHot || false;
        
        // 处理标签
        initTags();
        if (hotspot.tags && hotspot.tags.length > 0) {
          hotspot.tags.forEach(tag => addTag(tag));
        }
        
        // 处理封面图片
        coverPreview.src = hotspot.coverImage || '';
        if (hotspot.coverImage) {
          coverPreview.classList.remove('hidden');
          // 清空文件输入，因为我们使用预览而不是重新上传
          document.getElementById('coverImage').value = '';
        } else {
          coverPreview.classList.add('hidden');
        }
        
        hotspotModal.classList.remove('hidden');
      }
      
      // 确认删除
      function confirmDelete(id) {
        currentDeleteId = id;
        confirmDeleteModal.classList.remove('hidden');
      }
      
      // 保存热点数据
      function saveHotspot(event) {
        event.preventDefault();
        
        // 获取表单数据
        const formData = {
          title: document.getElementById('title').value,
          description: document.getElementById('description').value,
          videoCopy: document.getElementById('videoCopy').value,
          likeCount: parseInt(document.getElementById('likeCount').value) || 0,
          commentCount: parseInt(document.getElementById('commentCount').value) || 0,
          favoriteCount: parseInt(document.getElementById('favoriteCount').value) || 0,
          shareCount: parseInt(document.getElementById('shareCount').value) || 0,
          publishTime: document.getElementById('publishTime').value,
          videoUrl: document.getElementById('videoUrl').value,
          category: document.getElementById('category').value,
          tags: selectedTags.length > 0 ? selectedTags : [],
          isHot: document.getElementById('isHot').checked
        };
        
        // 调试：查看表单数据
        console.log('表单数据:', formData);
        console.log('视频文案编辑模式:', !!currentEditId);
        
        // 处理封面图片
        const coverImageInput = document.getElementById('coverImage');
        const file = coverImageInput.files[0];
        
        // 无论是否有新图片，都先保存表单数据（包括视频文案）
        // 保存表单数据（不包含封面图片）
        const formDataWithoutCover = { ...formData };
        delete formDataWithoutCover.coverImage;
        
        // 保存表单数据
        saveHotspotData(formDataWithoutCover);
        
        // 如果有新上传的图片，再更新封面图片
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            // 只更新封面图片
            const coverData = {
              coverImage: event.target.result
            };
            
            // 如果是编辑模式，直接更新
            if (currentEditId) {
              const existingHotspot = HotspotManager.getHotspotById(currentEditId);
              if (existingHotspot) {
                const updatedData = {
                  ...existingHotspot,
                  ...coverData,
                  updatedAt: new Date().toISOString()
                };
                HotspotManager.updateHotspot(currentEditId, updatedData);
              }
            } else {
              // 如果是新热点，先获取刚创建的热点，再更新封面
              const newHotspot = HotspotManager.getAllHotspots().pop();
              if (newHotspot) {
                const updatedData = {
                  ...newHotspot,
                  ...coverData,
                  updatedAt: new Date().toISOString()
                };
                HotspotManager.updateHotspot(newHotspot.id, updatedData);
              }
            }
            
            // 刷新列表
            renderHotspotList();
          };
          reader.readAsDataURL(file);
        }
        
        // 保存数据的函数
        function saveHotspotData(data) {
          try {
            if (currentEditId) {
              // 获取原有数据
              const existingHotspot = HotspotManager.getHotspotById(currentEditId);
              if (!existingHotspot) {
                throw new Error('未找到热点数据');
              }
              
              // 调试：查看现有数据
              console.log('现有数据:', existingHotspot);
              
              // 合并数据，保留原有字段
              const mergedData = {
                ...existingHotspot,
                ...data,
                // 确保id不变
                id: existingHotspot.id,
                // 保留创建时间
                createdAt: existingHotspot.createdAt,
                // 更新修改时间
                updatedAt: new Date().toISOString()
              };
              
              // 调试：查看合并后的数据
              console.log('合并后的数据:', mergedData);
              
              // 更新现有热点
              HotspotManager.updateHotspot(currentEditId, mergedData);
              showNotification('成功', '热点数据已更新');
            } else {
              // 添加新热点
              HotspotManager.addHotspot(data);
              showNotification('成功', '新热点已添加');
            }
            
            // 关闭模态框并刷新列表
            hotspotModal.classList.add('hidden');
            renderHotspotList();
          } catch (error) {
            showNotification('错误', error.message, 'error');
          }
        }
      }
      
      // 执行删除
      function performDelete() {
        if (currentDeleteId) {
          HotspotManager.deleteHotspot(currentDeleteId);
          showNotification('成功', '热点数据已删除');
          confirmDeleteModal.classList.add('hidden');
          renderHotspotList();
          currentDeleteId = null;
        }
      }
      
      // 导出数据
      function exportData() {
        HotspotManager.exportData();
        showNotification('成功', '数据已导出');
      }
      
      // 导入数据
      function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        HotspotManager.importData(file)
          .then(() => {
            showNotification('成功', '数据已导入');
            renderHotspotList();
            // 重置文件输入
            importFile.value = '';
          })
          .catch(error => {
            showNotification('错误', error.message, 'error');
            // 重置文件输入
            importFile.value = '';
          });
      }
      
      // 事件监听
      addNewBtn.addEventListener('click', openAddModal);
      addFirstBtn.addEventListener('click', openAddModal);
      exportBtn.addEventListener('click', exportData);
      importFile.addEventListener('change', importData);
      searchInput.addEventListener('input', renderHotspotList);
      closeModal.addEventListener('click', () => hotspotModal.classList.add('hidden'));
      cancelBtn.addEventListener('click', () => hotspotModal.classList.add('hidden'));
      hotspotForm.addEventListener('submit', saveHotspot);
      cancelDeleteBtn.addEventListener('click', () => confirmDeleteModal.classList.add('hidden'));
      confirmDeleteBtn.addEventListener('click', performDelete);
      closeNotification.addEventListener('click', hideNotification);
      
      // 点击模态框外部关闭
      hotspotModal.addEventListener('click', (e) => {
        // 检查点击的是否是模态框本身，而不是内部的表单元素
        if (e.target === hotspotModal || e.target === hotspotModal.firstElementChild) {
          hotspotModal.classList.add('hidden');
        }
      });
      
      confirmDeleteModal.addEventListener('click', (e) => {
        if (e.target === confirmDeleteModal) {
          confirmDeleteModal.classList.add('hidden');
        }
      });
      
      // 初始化渲染
      renderHotspotList();
    });
  </script>
</body>
</html>
